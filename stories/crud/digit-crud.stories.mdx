import { useState, useCallback, useRef } from "react";
import { Meta, Story, Preview, Props } from "@storybook/addon-docs/blocks";
import { DigitCRUD, DigitTextField } from "../../src";
import * as yup from "yup";
import xor from "lodash/xor";

<Meta
    title="Views|DigitCRUD"
    component={DigitCRUD}
/>

# DigitDatePicker

## DigitCRUD only readAll

<Preview>
    <Story name="readAll">
        {() => {
            const data = useRef([
                {
                    id: "asdf-fdsafasd",
                    name: "Theodor",
                    age: 55,
                },
                {
                    id: "fdas-fdsafasd",
                    name: "Sven",
                    age: 99,
                }
            ]);
            const getData = () => data.current;
            const setData = newData => {
                data.current = newData;
            };
            const readAllRequestPromise = () =>
                new Promise(resolve => {
                    resolve({
                        data: getData()
                    });
                });
            const readAllRequestCallback = useCallback(readAllRequestPromise, [data]);
            return (
                <DigitCRUD  path=""
                            name="users" 
                            readAllRequest={readAllRequestCallback}                         
                            keysOrder={["id", "name", "age"]}
                            keysText={{
                                id: "Id",
                                name: "Namn keys",
                                age: "Ålder",
                            }}
                            idProp="id"
                            tableProps={{
                                titleText: "Användare",
                                emptyTableText: "Det finns inga användare",
                                search: true,
                                startOrderBy: "name"
                            }}
                />
            );
        }}
    </Story>
</Preview>

## DigitCRUD with readAll and create

<Preview>
    <Story name="readAll and create">
        {() => {
            const data = useRef([
                {
                    id: "asdf-fdsafasd",
                    name: "Theodor",
                    age: 55,
                },
                {
                    id: "fdas-fdsafasd",
                    name: "Sven",
                    age: 99,
                }
            ]);
            const getData = () => data.current;
            const setData = newData => {
                data.current = newData;
            };
            const readAllRequestPromise = () =>
                new Promise(resolve => {
                    resolve({
                        data: getData()
                    });
                });
            const createRequestPromise = newUser =>
                new Promise(resolve => {
                    setData([...getData(), { ...newUser, id: "id-" + newUser.name }]);
                    resolve({});
                });
            const readAllRequestCallback = useCallback(readAllRequestPromise, [data]);
            const createRequestCallback = useCallback(createRequestPromise, [data]);
            return (
                <DigitCRUD  path=""
                            name="users2" 
                            readAllRequest={readAllRequestCallback}       
                            createRequest={createRequestCallback}                  
                            keysOrder={["id", "name", "age"]}
                            keysText={{
                                id: "Id",
                                name: "Namn",
                                age: "Ålder",
                            }}
                            idProp="id"
                            tableProps={{
                                titleText: "Användare",
                                emptyTableText: "Det finns inga användare",
                                search: true,
                                startOrderBy: "name"
                            }}
                            formComponentData={{
                                name: {
                                    component: DigitTextField,
                                    componentProps: {
                                        outlined: true
                                    }
                                },
                                age: {
                                    component: DigitTextField,
                                    componentProps: {
                                        numbersOnly: true,
                                        outlined: true,
                                    }
                                }
                            }}
                            formValidationSchema={
                                yup.object().shape({
                                    name: yup.string().required(),
                                    age: yup.number().required()
                                })
                            }
                            formInitialValues={{
                                name: "",
                                age: 18
                            }}
                            createTitle={"Skapa användare"}
                            createButtonText={"Skapa"}
                            toastCreateSuccessful={(data, response) =>
                                "Användaren " + data.name + " skapad"
                            }
                            toastCreateFailed={(data, error) =>
                                "Användaren " + data.name + " raderad"
                            }
                            backButtonText={"Tillbaka"}
                            useKeyTextsInUpperLabel
                />
            );
        }}
    </Story>
</Preview>

## DigitCRUD with readAll and readOne

<Preview>
    <Story name="readAll and readOne">
        {() => {
            const data = useRef([
                {
                    id: "asdf-fdsafasd",
                    name: "Theodor",
                    age: 55,
                },
                {
                    id: "fdas-fdsafasd",
                    name: "Sven",
                    age: 99,
                }
            ]);
            const getData = () => data.current;
            const setData = newData => {
                data.current = newData;
            };
            const readAllRequestPromise = () =>
                new Promise(resolve => {
                    resolve({
                        data: getData()
                    });
                });
            const readOneRequestPromise = id =>
                new Promise((resolve, reject) => {
                    const result = _.find(getData(), { id });
                    if (result == null) {
                        reject();
                    } else {
                        resolve({
                            data: {
                                ...result
                            }
                        });
                    }
                });
            const readAllRequestCallback = useCallback(readAllRequestPromise, [data]);
            const readOneRequestCallback = useCallback(readOneRequestPromise, [data]);
            return (
                <DigitCRUD  path=""
                            name="users3" 
                            readAllRequest={readAllRequestCallback}       
                            readOneRequest={readOneRequestCallback}
                            keysOrder={["id", "name", "age"]}
                            keysText={{
                                id: "Id",
                                name: "Namn",
                                age: "Ålder",
                            }}
                            idProp="id"
                            tableProps={{
                                titleText: "Användare",
                                emptyTableText: "Det finns inga användare",
                                search: true,
                                startOrderBy: "name"
                            }}
                            backButtonText={"Tillbaka"}
                            detailsButtonText={"Details"}
                            detailsTitle={(data) => data.name}
                />
            );
        }}
    </Story>
</Preview>

## DigitCRUD with readAll, readOne and deleteOne

<Preview>
    <Story name="readAll, readOne and deleteOne">
        {() => {
            const data = useRef([
                {
                    id: "asdf-fdsafasd",
                    name: "Theodor",
                    age: 55,
                },
                {
                    id: "fdas-fdsafasd",
                    name: "Sven",
                    age: 99,
                }
            ]);
            const getData = () => data.current;
            const setData = newData => {
                data.current = newData;
            };
            const readAllRequestPromise = () =>
                new Promise(resolve => {
                    resolve({
                        data: getData()
                    });
                });
            const readOneRequestPromise = id =>
                new Promise((resolve, reject) => {
                    const result = _.find(getData(), { id });
                    if (result == null) {
                        reject({error: "Can't find anything with the id: " + id});
                    } else {
                        resolve({
                            data: {
                                ...result
                            }
                        });
                    }
                });
            const deleteRequestPromise = (id, form) =>
                new Promise((resolve, reject) => {
                    const one = _.find(getData(), { id });
                    if (form.nameConfirm !== one.name) {
                        reject({error: "Name confirm not correct"});
                    }else{
                        setData(xor(getData(), [one]));
                        resolve({});
                    }
                });
            const readAllRequestCallback = useCallback(readAllRequestPromise, [data]);
            const readOneRequestCallback = useCallback(readOneRequestPromise, [data]);
            const deleteRequestCallback = useCallback(deleteRequestPromise, [data]);
            return (
                <DigitCRUD  path=""
                            name="users4" 
                            readAllRequest={readAllRequestCallback}       
                            readOneRequest={readOneRequestCallback}
                            deleteRequest={deleteRequestCallback}
                            keysOrder={["id", "name", "age"]}
                            keysText={{
                                id: "Id",
                                name: "Namn",
                                age: "Ålder",
                            }}
                            idProp="id"
                            tableProps={{
                                titleText: "Användare",
                                emptyTableText: "Det finns inga användare",
                                search: true,
                                startOrderBy: "name"
                            }}
                            backButtonText={"Tillbaka"}
                            detailsButtonText={"Details"}
                            detailsTitle={(data) => data.name}
                            toastDeleteSuccessful={(data, response) =>
                                "Användare " + data.name + " har raderats"
                            }
                            toastDeleteFailed={(data, error) =>
                                "Radering av användare " +
                                data.name +
                                " misslyckades"
                            }
                            deleteDialogFormComponentData={{
                                nameConfirm: {
                                    component: DigitTextField,
                                    componentProps: {
                                        upperLabel: "Bekräfta namnet",
                                        outlined: true
                                    }
                                }
                            }}
                            deleteDialogFormInitialValues={{
                                nameConfirm: ""
                            }}
                            deleteDialogFormValidationSchema={data =>
                                yup.object().shape({
                                    nameConfirm: yup
                                        .mixed()
                                        .oneOf(
                                            [data.name],
                                            "Måste vara lika med namnet på användaren"
                                        )
                                        .required("du bekräfta namn")
                                })
                            }
                            deleteDialogFormKeysOrder={["nameConfirm"]}
                            useKeyTextsInUpperLabel
                />
            );
        }}
    </Story>
</Preview>

## DigitCRUD with readAll, readOne and update

<Preview>
    <Story name="readAll, readOne and update">
        {() => {
            const data = useRef([
                {
                    id: "asdf-fdsafasd",
                    name: "Theodor",
                    age: 55,
                },
                {
                    id: "fdas-fdsafasd",
                    name: "Sven",
                    age: 99,
                }
            ]);
            const getData = () => data.current;
            const setData = newData => {
                data.current = newData;
            };
            const readAllRequestPromise = () =>
                new Promise(resolve => {
                    resolve({
                        data: getData()
                    });
                });
            const readOneRequestPromise = id =>
                new Promise((resolve, reject) => {
                    const result = _.find(getData(), { id });
                    if (result == null) {
                        reject({error: "Can't find anything with the id: " + id});
                    } else {
                        resolve({
                            data: {
                                ...result
                            }
                        });
                    }
                });
            const updateRequestPromise = (id, newUser) =>
                new Promise((resolve, reject) => {
                    const index = _.findIndex(getData(), { id });
                    if (index === -1) {
                        reject();
                    } else {
                        const newData = [...getData()];
                        newData[index] = { id, ...newUser };
                        setData(newData);
                        resolve({});
                    }
                });
            const readAllRequestCallback = useCallback(readAllRequestPromise, [data]);
            const readOneRequestCallback = useCallback(readOneRequestPromise, [data]);
            const updateRequestCallback = useCallback(updateRequestPromise, [data]);
            return (
                <DigitCRUD  path=""
                            name="users5" 
                            readAllRequest={readAllRequestCallback}       
                            readOneRequest={readOneRequestCallback}
                            updateRequest={updateRequestCallback}
                            keysOrder={["id", "name", "age"]}
                            keysText={{
                                id: "Id",
                                name: "Namn",
                                age: "Ålder",
                            }}
                            idProp="id"
                            tableProps={{
                                titleText: "Användare",
                                emptyTableText: "Det finns inga användare",
                                search: true,
                                startOrderBy: "name"
                            }}
                            backButtonText={"Tillbaka"}
                            detailsButtonText={"Details"}
                            detailsTitle={(data) => data.name}
                            useKeyTextsInUpperLabel
                            formComponentData={{
                                name: {
                                    component: DigitTextField,
                                    componentProps: {
                                        outlined: true
                                        // upperLabel: "Namn"
                                    }
                                },
                                age: {
                                    component: DigitTextField,
                                    componentProps: {
                                        numbersOnly: true,
                                        outlined: true,
                                        upperLabel: "Ålder"
                                    }
                                }
                            }}
                            formValidationSchema={yup.object().shape({
                                name: yup.string().required(),
                                age: yup.number().required()
                            })}
                            formInitialValues={{
                                name: "",
                                age: 18
                            }}
                            updateTitle={data =>
                                "Uppdatera " + data.name + " användare"
                            }
                            toastUpdateSuccessful={(updated, old, response) =>
                                "Användare " + updated.name + " har uppdateras"
                            }
                            toastUpdateFailed={(updated, old, error) =>
                                "Användare " + updated.name + " har inte uppdateras"
                            }    
                />
            );
        }}
    </Story>
</Preview>

## DigitCRUD with readAll, readOne, update and delete

<Preview>
    <Story name="readAll, readOne, update and delete">
        {() => {
            const data = useRef([
                {
                    id: "asdf-fdsafasd",
                    name: "Theodor",
                    age: 55,
                },
                {
                    id: "fdas-fdsafasd",
                    name: "Sven",
                    age: 99,
                }
            ]);
            const getData = () => data.current;
            const setData = newData => {
                data.current = newData;
            };
            const readAllRequestPromise = () =>
                new Promise(resolve => {
                    resolve({
                        data: getData()
                    });
                });
            const readOneRequestPromise = id =>
                new Promise((resolve, reject) => {
                    const result = _.find(getData(), { id });
                    if (result == null) {
                        reject({error: "Can't find anything with the id: " + id});
                    } else {
                        resolve({
                            data: {
                                ...result
                            }
                        });
                    }
                });
            const updateRequestPromise = (id, newUser) =>
                new Promise((resolve, reject) => {
                    const index = _.findIndex(getData(), { id });
                    if (index === -1) {
                        reject();
                    } else {
                        const newData = [...getData()];
                        newData[index] = { id, ...newUser };
                        setData(newData);
                        resolve({});
                    }
                });
            const deleteRequestPromise = (id, form) =>
                new Promise((resolve, reject) => {
                    const one = _.find(getData(), { id });
                    setData(xor(getData(), [one]));
                    resolve({});
                });
            const readAllRequestCallback = useCallback(readAllRequestPromise, [data]);
            const readOneRequestCallback = useCallback(readOneRequestPromise, [data]);
            const updateRequestCallback = useCallback(updateRequestPromise, [data]);
            const deleteRequestCallback = useCallback(deleteRequestPromise, [data]);
            return (
                <DigitCRUD  path=""
                            name="users6" 
                            readAllRequest={readAllRequestCallback}       
                            readOneRequest={readOneRequestCallback}
                            updateRequest={updateRequestCallback}
                            deleteRequest={deleteRequestCallback}
                            keysOrder={["id", "name", "age"]}
                            keysText={{
                                id: "Id",
                                name: "Namn",
                                age: "Ålder",
                            }}
                            idProp="id"
                            tableProps={{
                                titleText: "Användare",
                                emptyTableText: "Det finns inga användare",
                                search: true,
                                startOrderBy: "name"
                            }}
                            backButtonText={"Tillbaka"}
                            detailsButtonText={"Details"}
                            detailsTitle={(data) => data.name}
                            useKeyTextsInUpperLabel
                            formComponentData={{
                                name: {
                                    component: DigitTextField,
                                    componentProps: {
                                        outlined: true
                                        // upperLabel: "Namn"
                                    }
                                },
                                age: {
                                    component: DigitTextField,
                                    componentProps: {
                                        numbersOnly: true,
                                        outlined: true,
                                        upperLabel: "Ålder"
                                    }
                                }
                            }}
                            formValidationSchema={yup.object().shape({
                                name: yup.string().required(),
                                age: yup.number().required()
                            })}
                            formInitialValues={{
                                name: "",
                                age: 18
                            }}
                            updateTitle={data =>
                                "Uppdatera " + data.name + " användare"
                            }
                            toastUpdateSuccessful={(updated, old, response) =>
                                "Användare " + updated.name + " har uppdateras"
                            }
                            toastUpdateFailed={(updated, old, error) =>
                                "Användare " + updated.name + " har inte uppdateras"
                            }
                            toastDeleteSuccessful={(data, response) =>
                                "Användare " + data.name + " har raderats"
                            }
                            toastDeleteFailed={(data, error) =>
                                "Radering av användare " +
                                data.name +
                                " misslyckades"
                            }
                />
            );
        }}
    </Story>
</Preview>

## DigitCRUD with readAll, readOne, update, delete and create (All of them)

<Preview>
    <Story name="readAll, readOne, update, delete and create">
        {() => {
            const data = useRef([
                {
                    id: "asdf-fdsafasd",
                    name: "Theodor",
                    age: 55,
                },
                {
                    id: "fdas-fdsafasd",
                    name: "Sven",
                    age: 99,
                }
            ]);
            const getData = () => data.current;
            const setData = newData => {
                data.current = newData;
            };
            const readAllRequestPromise = () =>
                new Promise(resolve => {
                    resolve({
                        data: getData()
                    });
                });
            const readOneRequestPromise = id =>
                new Promise((resolve, reject) => {
                    const result = _.find(getData(), { id });
                    if (result == null) {
                        reject({error: "Can't find anything with the id: " + id});
                    } else {
                        resolve({
                            data: {
                                ...result
                            }
                        });
                    }
                });
            const updateRequestPromise = (id, newUser) =>
                new Promise((resolve, reject) => {
                    const index = _.findIndex(getData(), { id });
                    if (index === -1) {
                        reject();
                    } else {
                        const newData = [...getData()];
                        newData[index] = { id, ...newUser };
                        setData(newData);
                        resolve({});
                    }
                });
            const deleteRequestPromise = (id, form) =>
                new Promise((resolve, reject) => {
                    const one = _.find(getData(), { id });
                    setData(xor(getData(), [one]));
                    resolve({});
                });
            const createRequestPromise = newUser =>
                new Promise(resolve => {
                    setData([...getData(), { ...newUser, id: "id-" + newUser.name }]);
                    resolve({});
                });
            const readAllRequestCallback = useCallback(readAllRequestPromise, [data]);
            const readOneRequestCallback = useCallback(readOneRequestPromise, [data]);
            const updateRequestCallback = useCallback(updateRequestPromise, [data]);
            const deleteRequestCallback = useCallback(deleteRequestPromise, [data]);
            const createRequestCallback = useCallback(createRequestPromise, [data]);
            return (
                <DigitCRUD  path=""
                            name="users7" 
                            readAllRequest={readAllRequestCallback}       
                            readOneRequest={readOneRequestCallback}
                            updateRequest={updateRequestCallback}
                            deleteRequest={deleteRequestCallback}
                            keysOrder={["id", "name", "age"]}
                            keysText={{
                                id: "Id",
                                name: "Namn",
                                age: "Ålder",
                            }}
                            idProp="id"
                            tableProps={{
                                titleText: "Användare",
                                emptyTableText: "Det finns inga användare",
                                search: true,
                                startOrderBy: "name"
                            }}
                            backButtonText={"Tillbaka"}
                            detailsButtonText={"Details"}
                            detailsTitle={(data) => data.name}
                            useKeyTextsInUpperLabel
                            formComponentData={{
                                name: {
                                    component: DigitTextField,
                                    componentProps: {
                                        outlined: true
                                        // upperLabel: "Namn"
                                    }
                                },
                                age: {
                                    component: DigitTextField,
                                    componentProps: {
                                        numbersOnly: true,
                                        outlined: true,
                                        upperLabel: "Ålder"
                                    }
                                }
                            }}
                            formValidationSchema={yup.object().shape({
                                name: yup.string().required(),
                                age: yup.number().required()
                            })}
                            formInitialValues={{
                                name: "",
                                age: 18
                            }}
                            updateTitle={data =>
                                "Uppdatera " + data.name + " användare"
                            }
                            toastUpdateSuccessful={(updated, old, response) =>
                                "Användare " + updated.name + " har uppdateras"
                            }
                            toastUpdateFailed={(updated, old, error) =>
                                "Användare " + updated.name + " har inte uppdateras"
                            }
                            toastDeleteSuccessful={(data, response) =>
                                "Användare " + data.name + " har raderats"
                            }
                            toastDeleteFailed={(data, error) =>
                                "Radering av användare " +
                                data.name +
                                " misslyckades"
                            }
                            toastCreateSuccessful={(data, response) =>
                                "Användaren " + data.name + " skapad"
                            }
                            toastCreateFailed={(data, error) =>
                                "Användaren " + data.name + " raderad"
                            }
                />
            );
        }}
    </Story>
</Preview>

<Props of={DigitCRUD} />
