import { Meta } from "@storybook/addon-docs/blocks";

<Meta title="Hooks/useGamma*"/>

# Gamma hooks
RDC provides several useful hooks for integration with Gamma. 

# WTF is Gamma?
Gamma is the IT divisions user authentication system. You can read more about it here: 

https://github.com/cthit/Gamma/wiki/

# What do I **REALLY** need to know before using these hooks?
**This is very important to have in mind when using the Gamma hooks in the frontend.** When sending information about the signed in user to your backend, **do not trust the JWT token**. Always validate it by the Gamma api. You need to read more about this from here: 

https://github.com/cthit/Gamma/wiki/Secure-authentication-with-Gamma

## `useGamma`
The only required hook for integration with Gamma. Here are its props:

| **Name**                	| **Type**  	| **Description**                                                                                                                                                                            	| **Default value**                             	|
|-------------------------	|-----------	|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------	|-----------------------------------------------	|
| **name**                	| *string*  	| The name of your application. Only used locally to distinguish the key for the sessionStorage.                                                                                             	| "MyApp"                                       	|
| **id**                  	| *string*  	| Client id of your application.                                                                                                                                                             	| "id"                                          	|
| **secret**              	| *string*  	| Client secret of your application. Might seems insecure, but the key is redirect, and that it *only* redirects to your application.                                                        	| "secret"                                      	|
| **redirect**            	| *string*  	| Client redirect of your application. Is what Gamma will redirect the user after they have signed in.                                                                                       	| "http://localhost:3001/auth/account/callback" 	|
| **gammaPath**           	| *string*  	| The url to Gamma. Note that you yourself need to take into account if ENV is production or development.                                                                                    	| "http://localhost:8081/api"                   	|
| **forceSignedIn**       	| *boolean* 	| If true, then the user will be redirected to Gamma for sign in incase the user session expires or something else.                                                                          	| true                                          	|
| **redirectToOnLogin**   	| *string*  	| What the hook should redirect to after the user have been logged in successfully. Note the difference between redirect and this. Redirect stems from the information from the Gamma client 	| "/"                                           	|
| **refreshOnFocus**      	| *boolean* 	| When the user focuses on the website, it checks if the token has expired or been corrupted. If it has, then it refreshes the session token.                                                	| false                                         	|
| **toastSignedOutText**  	| *string*  	| The text to display on the toast when the user has been signed out                                                                                                                         	| "You're signed out"                           	|
| **toastSignBackInText** 	| *string*  	| The button text to sign in the user again                                                                                                                                                  	| "Press to sign in"                            	|
| **signOutTo**           	| *string*  	| What to redirect to when the user has been signed out from the website.                                                                                                                    	| "/"                                           	|
| **toast**               	| *boolean* 	| If true, then a toast will be shown when the user has been signed out from the website.                                                                                                    	| true                                          	|
| **signOutFromGamma**    	| *boolean* 	| If true, then the user will be signed out from gamma, not just the website, when signing out from the website.                                                                             	| false                                         	|

The `useGamma` hook returns nothing. 

## `useGammaUser`
Returns an object of the gamma user. Find out the props of it by logging the object, they are all pretty self explanatory. 

## `useGammaInvalidateMe`
Returns a function that is used to get a new version of the user. The function in turn returns a Promise. The word *invalidate* stems in that the context value that `useGammaUser` uses updates. This function is called after first render automatically when `useGamma` has been set up.

## `useGammaIs`
Takes in three arguments: `(name, checkAuthority, checkSuperGroups)`. 
`name` is required. It's the name of the authority or supergroup that is checked on.
`checkAuthority`, true by default. If you want to check if the authority with the give name exists for the signed in user.
`checkSuperGroups`, true by default. If you want to check if the user is a part of the super group with the given name.

Returns a boolean if the signed in user has the given authority or is in a supergroup with the given name.

### `useGammaIsAdmin`
Is a helper hook using `useGammaIs` that checks if the type is "admin". Also returns a boolean if the user is an admin.

## `useGammaSignIn`
Returns a function that can be used to redirect to Gamma for a sign in.

## `useGammaSignOut`
Returns a function that clears the user from the browser. If `forceSignedIn` is true in `useGamma`, then the user will be redirected to Gamma.

## `useGammaStatus`
Returns an array of two elements: `[loading, error]`. Where `loading` refers to if RDC is still trying to sign in the user and `error` referes to if something went wrong when signing in. 
